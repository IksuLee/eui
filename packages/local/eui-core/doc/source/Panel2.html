<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;eui.grid.Panel&#39;, {
    extend: &#39;Ext.grid.Panel&#39;,
    alias: &#39;widget.euigrid&#39;,
    columnLines: true,
//    ui: &#39;basicgrid&#39;,

    localeProperties: [&#39;title&#39;],

    mixins: [
        &#39;eui.mixin.Panel&#39;
    ],

    config: {
        showRowAddBtn: false,
        showRowDelBtn: false,
        showRowRegBtn: false,
        showRowModBtn: false,
        showRowSaveBtn: false,

        // defaultButtons에 추가할 버튼을 정의한다.
        otherButtons: null,

        usePagingToolbar: false
    },


    initComponent: function () {
        var me = this;

        me.setBottomToolbar();

        me.callParent(arguments);

    },

    checkComplete: function (editor, context) {
        var view = context.grid.getView(),
            rowIdx = context.rowIdx,
            record = context.record,
            nodeId = context.node.id;

        if (record.dirty) {
            context.grid.selModel.doDeselect(record);
            Ext.get(nodeId).select(&#39;.x-grid-row-checker&#39;).elements[0].click()
        } else {
            context.grid.selModel.doDeselect(record);
        }

    },

<span id='global-method-checkDeselect'>    /***
</span>     * 그리드 내부 에디터
     * @param editor
     * @param context
     */
    checkDeselect: function (editor, context) {
        var view = context.grid.getView(),
            rowIdx = context.rowIdx,
            record = context.record,
            nodeId = context.node.id;

        context.grid.selModel.doDeselect(record);
        Ext.get(nodeId).select(&#39;.x-grid-row-checker&#39;).elements[0].click()
    },

    onRender: function (cmp) {
        this.setPagingToolbarStore();
        this.callParent(arguments);
    },

<span id='global-method-setPagingToolbarStore'>    /***
</span>     * Paging Toolbar store를 설정한다.
     */
    setPagingToolbarStore: function () {
        var me = this;
        if (me.getUsePagingToolbar()) {
            if (this.bind &amp;&amp; this.bind[&#39;store&#39;]) {
                this.down(&#39;pagingtoolbar&#39;).setBind({
                    store: &#39;{&#39; + this.bind.store.stub.name + &#39;}&#39;
                });
            } else if (this.store) {
                this.down(&#39;pagingtoolbar&#39;).bindStore(this.store);
            }
        }
    },

<span id='global-method-onRowAdd'>    /***
</span>     * 행추가 처리.
     * @param grid
     * @param data
     * @param idx
     * @param callback
     * @example
     * // 확장한 클래스 내부 메소드로 override 할 경우
     * onRowAdd: function () {
     *      // this.callParent를 꼭 호출하고 arguments를 전달한다.
     *      this.callParent([this, {
     *        ULD_NO : &#39;111222&#39;
     *    },0, function () {    // callback이 필요할 경우 구현한다.
     *        console.log(&#39;그리드 내부에서 콜백철...&#39;)
     *    }]);
     * }
     * // 뷰컨트롤러에서 처리하려 할 경우. spgridaddrow이벤트 리스너를 구현한다.
     * listeners: {
     *      rowAddBtnClick: &#39;myControlMethod&#39;
     * }
     *
     * // 뷰컨트롤러의 myControlMethod
     *  myControlMethod: function (grid) {
     *      // onRowAdd메소드를 직접호출한다. 원치 않을 경우 자체 로직으로 처리하고 호출하지 않을 수 있다.
     *      grid.superclass.onRowAdd(
     *          grid,   // 해당 그리드
     *          {       // 추가할 모델오브젝트
     *              ULD_NO : &#39;111&#39;
     *          },
     *          0,      // 추가할 위치
     *          this.myCallback, // 추가 이후 콜백이 필요하면 컨트롤러 내부에 구현한다.
     *          this    // 콜백에서 사용할 scope이다. this를 전달하지 않을 경우 콜백 내부에서 this는 grid가 된다.
     *     );
     *  }
     */
    onRowAdd: function (grid, data, idx, callback, scope) {
        if (!idx) {
            idx = 0;
        }
        var store = grid.getStore();
        if (Ext.isEmpty(idx)) {
            store.add(data);
        } else {
            store.insert(idx, data);
        }

        var index = store.indexOf(data);
//        grid.getView().focusRow(index);
        console.log(&#39;index&#39;, index)
        var selectionModel = grid.getSelectionModel();
        selectionModel.select(index);

        if (Ext.isEmpty(scope)) {
            scope = grid;
        }
        if (Ext.isFunction(callback)) {
            Ext.callback(callback, scope, [grid, selectionModel.getSelection()[0] ]);
        }
    },

<span id='global-method-onRowDelete'>    /***
</span>     * 선택된 로우를 삭제처리한다.
     * @param grid
     * @param callback
     * @param scope
     */
    onRowDelete: function (grid, callback, scope) {
        var sel = grid.getSelection(),
            model = grid.getSelection()[0],
            list;

        if (!model || !model.isModel) {
            Ext.Msg.alert(&#39;Erorr&#39;, &#39;#{삭제할 항목을 선택하여 주십시오}&#39;);
            return;
        }
        if (Ext.isArray(sel) &amp;&amp; sel.length &gt; 1) {
            list = [];
            Ext.Array.each(sel, function (itm) {
                list.push(itm.getData());
            });
        }

        if (Ext.isEmpty(scope)) {
            scope = grid;
        }

        Ext.Msg.show({
            title: &#39;#{삭제}&#39;,
            buttons: Ext.Msg.YESNO,
            icon: Ext.Msg.QUESTION,
            message: &#39;#{삭제하시겠습니까?}&#39;,
            fn: function (btn) {
                if (btn === &#39;yes&#39;) {
                    // 위치 고민...
//                    grid.store.remove(sel);
                    if (Ext.isFunction(callback)) {
                        Ext.callback(callback, scope, [grid.store, sel]);
                    }
                }
            }
        });

    },

    onSave: function (grid) {
        var me = this;
        me.store.sync();
    },

    onReload: function () {
        var me = this;
        me.store.reload();
    },

    setBottomToolbar: function () {
        var me = this;
        var buttons = [
            {
                xtype: &#39;spbutton&#39;,
                text: &#39;#{행추가}&#39;,
                iconCls: &#39;#{행추가아이콘}&#39;,
                scope: me,
                hidden: !me.getShowRowAddBtn(),
                listeners: {
                    click: function () {
                        if (me.hasListeners[&#39;SPGridRowAdd&#39;.toLowerCase()]) {
                            me.fireEvent(&#39;SPGridRowAdd&#39;, me);
                        } else {
                            me.onRowAdd(me, {
                                randomInt : Ext.Number.randomInt(1, 1000000000000)
                            }, 0, null);
                        }
                    }
                }
            },
            {
                xtype: &#39;spbutton&#39;,
                iconCls: &#39;#{행삭제아이콘}&#39;,
                text: &#39;#{행삭제}&#39;,
                scope: me,
                hidden: !me.getShowRowDelBtn(),
                listeners: {
                    click: function () {
                        if (me.hasListeners[&#39;SPGridRowDel&#39;.toLowerCase()]) {
                            me.fireEvent(&#39;SPGridRowDel&#39;, me);
                        } else {
                            me.onRowDel(me, null, me);
                        }
                    }
                }
            },
            {
                xtype: &#39;spbutton&#39;,
                text: &#39;#{등록}&#39;,
                iconCls: &#39;#{등록아이콘}&#39;,
                hidden: !me.getShowRowRegBtn(),
                listeners: {
                    click: function () {
                        me.fireEvent(&#39;SPGridRowReg&#39;, me);
                    }
                }
            },
            {
                xtype: &#39;spbutton&#39;,
                text: &#39;#{수정}&#39;,
                iconCls: &#39;#{수정아이콘}&#39;,
                hidden: !me.getShowRowModBtn(),
                listeners: {
                    click: function () {
                        me.fireEvent(&#39;SPGridRowMod&#39;, me);
                    }
                }
            },
            {
                xtype: &#39;spbutton&#39;,
                text: &#39;#{저장}&#39;,
                iconCls: &#39;#{저장아이콘}&#39;,
                hidden: !me.getShowRowSaveBtn(),
                listeners: {
                    click: function () {
                        if (me.hasListeners[&#39;SPGridRowSave&#39;.toLowerCase()]) {
                            me.fireEvent(&#39;SPGridRowSave&#39;, me);
                        } else {
                            me.onRowSave();
                        }
                    }
                }
            }
        ];
        var btns = this.applyButtonToolBar(buttons, this.otherButtons);
        if (me.getUsePagingToolbar()) {
            if (Ext.isEmpty(me.dockedItems)) {
                me.dockedItems = [];
            }
            me.dockedItems.push(
                {
                    xtype: &#39;pagingtoolbar&#39;,
                    dock: &#39;bottom&#39;,
                    displayInfo: true
                }
            );
        }
    }
});</pre>
</body>
</html>
